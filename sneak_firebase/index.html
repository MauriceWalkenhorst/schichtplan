<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sneak Prognose | UCI Ruhr Park</title>
    <meta name="theme-color" content="#0f0f0f">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        
        window.firebaseModule = { initializeApp, getFirestore, doc, setDoc, getDoc, onSnapshot };
        window.initApp();
    </script>
    <style>
        * { font-family: 'Space Grotesk', sans-serif; }
        .glass { background: rgba(255,255,255,0.05); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); }
        .poster { transition: transform 0.3s; }
        .poster:hover { transform: scale(1.05); }
        .star { transition: all 0.2s; }
        .star:hover { transform: scale(1.2); }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .pulse { animation: pulse 2s infinite; }
        [x-cloak] { display: none !important; }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-gray-800 to-black text-white min-h-screen" x-data="sneakApp()" x-init="init()">
    <div class="max-w-md mx-auto px-4 py-8">
        <!-- Header -->
        <header class="text-center mb-8">
            <div class="flex items-center justify-center gap-2 mb-2">
                <h1 class="text-3xl font-bold">Sneak Prognose</h1>
                <span class="text-2xl">üé¨</span>
            </div>
            <p class="text-gray-400 text-sm">UCI Ruhr Park</p>
            <div class="mt-2">
                <span class="inline-flex items-center gap-1 text-xs">
                    <span class="w-2 h-2 rounded-full" :class="online ? 'bg-emerald-400' : 'bg-red-400'"></span>
                    <span :class="online ? 'text-emerald-400' : 'text-red-400'" x-text="online ? 'Online' : 'Offline'"></span>
                </span>
            </div>
        </header>

        <!-- Countdown -->
        <div class="glass rounded-2xl p-6 mb-6 text-center">
            <p class="text-gray-400 text-sm mb-2">N√§chste Sneak (Montag 19:00)</p>
            <div class="text-5xl font-bold text-emerald-400 mb-2" x-text="countdown">--:--:--</div>
            <p class="text-gray-500 text-sm" x-text="nextMondayText"></p>
        </div>

        <!-- Admin Button -->
        <div class="flex justify-end mb-4">
            <button @click="adminModal = true" class="text-xs text-gray-500 hover:text-gray-300">
                ‚öôÔ∏è Admin
            </button>
        </div>

        <!-- This Week - German -->
        <div class="glass rounded-2xl p-6 mb-6">
            <div class="flex items-center justify-between mb-4">
                <span class="px-3 py-1 bg-emerald-500 text-black text-xs font-bold rounded-full">DEUTSCHE SNEAK</span>
            </div>
            <template x-if="data.de">
                <div class="text-center">
                    <div class="text-2xl font-bold mb-2" x-text="data.de.title"></div>
                    <p class="text-gray-400 text-sm" x-text="data.de.meta"></p>
                    <a :href="'https://www.themoviedb.org/search?query=' + encodeURIComponent(data.de.title)" 
                       target="_blank"
                       class="inline-block mt-3 text-emerald-400 text-sm hover:underline">
                        Auf TMDB ‚Üí
                    </a>
                </div>
            </template>
            <template x-if="!data.de">
                <p class="text-gray-400 text-center py-4">Noch kein Film eingetragen</p>
            </template>
        </div>

        <!-- This Week - OV -->
        <div class="glass rounded-2xl p-6 mb-6">
            <div class="flex items-center justify-between mb-4">
                <span class="px-3 py-1 bg-purple-500 text-white text-xs font-bold rounded-full">OV SNEAK</span>
            </div>
            <template x-if="data.ov">
                <div class="text-center">
                    <div class="text-2xl font-bold mb-2" x-text="data.ov.title"></div>
                    <p class="text-gray-400 text-sm" x-text="data.ov.meta"></p>
                    <a :href="'https://www.themoviedb.org/search?query=' + encodeURIComponent(data.ov.title)" 
                       target="_blank"
                       class="inline-block mt-3 text-purple-400 text-sm hover:underline">
                        Auf TMDB ‚Üí
                    </a>
                </div>
            </template>
            <template x-if="!data.ov">
                <p class="text-gray-400 text-center py-4">Noch kein Film eingetragen</p>
            </template>
        </div>

        <!-- Prediction -->
        <div class="glass rounded-2xl p-6 mb-6">
            <div class="flex items-center gap-2 mb-4">
                <span class="px-3 py-1 bg-orange-500/20 text-orange-400 text-xs font-bold rounded-full border border-orange-500/30">PROGNOSE N√ÑCHSTE WOCHE</span>
            </div>
            
            <template x-if="data.prediction">
                <div class="text-center mb-4">
                    <div class="text-xl font-bold" x-text="data.prediction.title"></div>
                    <div class="mt-2">
                        <div class="h-3 bg-gray-700 rounded-full overflow-hidden">
                            <div class="h-full bg-gradient-to-r from-orange-500 to-yellow-400" 
                                 :style="'width: ' + data.prediction.prob + '%'"></div>
                        </div>
                        <p class="text-orange-400 text-sm mt-1" x-text="data.prediction.prob + '% Wahrscheinlichkeit'"></p>
                    </div>
                </div>
            </template>
            
            <template x-if="!data.prediction">
                <p class="text-gray-500 text-center py-2 mb-4">Noch keine Prognose</p>
            </template>
            
            <!-- Admin: Neue Prognose -->
            <template x-if="isAdmin">
                <div class="mt-4 pt-4 border-t border-gray-700">
                    <input type="text" x-model="newPrediction.title" placeholder="Filmtitel..." 
                           class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-2 text-white placeholder-gray-500 focus:outline-none focus:border-emerald-500 mb-2 text-sm">
                    <div class="flex gap-2 items-center">
                        <input type="range" x-model="newPrediction.prob" min="10" max="100" class="flex-1 accent-emerald-500">
                        <span class="text-emerald-400 font-bold text-sm w-12" x-text="newPrediction.prob + '%'"></span>
                    </div>
                    <button @click="savePrediction()" class="w-full mt-2 bg-emerald-500 hover:bg-emerald-400 text-black font-bold py-2 rounded-xl text-sm">
                        Prognose speichern
                    </button>
                </div>
            </template>
        </div>

        <!-- Archive -->
        <div class="glass rounded-2xl p-6">
            <h3 class="font-bold mb-4">üìö Historie</h3>
            <template x-if="data.archive && data.archive.length > 0">
                <div class="space-y-2 max-h-64 overflow-y-auto">
                    <template x-for="item in data.archive" :key="item.id">
                        <div class="flex justify-between items-center py-2 border-b border-gray-700">
                            <div>
                                <div class="font-medium text-sm" x-text="item.title"></div>
                                <div class="text-xs text-gray-500" x-text="item.date"></div>
                            </div>
                            <div class="text-yellow-400 text-sm" x-text="'‚òÖ'.repeat(item.rating || 0)"></div>
                        </div>
                    </template>
                </div>
            </template>
            <template x-if="!data.archive || data.archive.length === 0">
                <p class="text-gray-500 text-sm text-center py-4">Noch keine Filme in der Historie</p>
            </template>
        </div>

        <!-- Rating -->
        <div class="mt-6 text-center">
            <p class="text-gray-400 text-sm mb-2">Bewerte die aktuelle Sneak</p>
            <div class="flex justify-center gap-1">
                <template x-for="i in 5" :key="i">
                    <button @click="rate(i)" 
                            class="star text-3xl transition-all"
                            :class="i <= userRating ? 'text-yellow-400' : 'text-gray-600'">
                        ‚òÖ
                    </button>
                </template>
            </div>
            <p x-show="ratingSaved" class="text-emerald-400 text-sm mt-2">‚úì Gespeichert</p>
        </div>

        <!-- Admin Modal -->
        <div x-show="adminModal" x-cloak class="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50">
            <div class="glass rounded-2xl p-6 w-full max-w-sm">
                <h3 class="font-bold text-lg mb-4">‚öôÔ∏è Admin Login</h3>
                <template x-if="!isAdmin">
                    <div>
                        <input type="password" x-model="adminPassword" placeholder="Passwort" 
                               class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-2 text-white placeholder-gray-500 focus:outline-none focus:border-emerald-500 mb-3">
                        <button @click="checkAdmin()" class="w-full bg-emerald-500 text-black font-bold py-2 rounded-xl">Login</button>
                    </div>
                </template>
                <template x-if="isAdmin">
                    <div class="space-y-4">
                        <div>
                            <label class="text-xs text-gray-400">Deutsche Sneak</label>
                            <input type="text" x-model="adminData.de.title" placeholder="Titel" class="w-full bg-gray-800 border border-gray-700 rounded-xl px-3 py-2 text-white text-sm mb-2">
                            <input type="text" x-model="adminData.de.meta" placeholder="Meta (z.B. 2024 ¬∑ Action)" class="w-full bg-gray-800 border border-gray-700 rounded-xl px-3 py-2 text-white text-sm">
                        </div>
                        <div>
                            <label class="text-xs text-gray-400">OV Sneak</label>
                            <input type="text" x-model="adminData.ov.title" placeholder="Titel" class="w-full bg-gray-800 border border-gray-700 rounded-xl px-3 py-2 text-white text-sm mb-2">
                            <input type="text" x-model="adminData.ov.meta" placeholder="Meta" class="w-full bg-gray-800 border border-gray-700 rounded-xl px-3 py-2 text-white text-sm">
                        </div>
                        <button @click="saveAll()" class="w-full bg-emerald-500 text-black font-bold py-2 rounded-xl">Speichern</button>
                    </div>
                </template>
                <button @click="adminModal = false" class="mt-3 w-full text-gray-500 text-sm">Schlie√üen</button>
            </div>
        </div>

    </div>

    <script>
        window.initApp = function() {
            if (!window.firebaseModule) {
                setTimeout(window.initApp, 100);
                return;
            }
            
            const { initializeApp, getFirestore, doc, setDoc, getDoc, onSnapshot } = window.firebaseModule;
            
            // Firebase Config
            const firebaseConfig = {
                apiKey: "AIzaSyBmXq8SqmYD0SNQ7OGRZJ97_1_KLKeEn70",
                authDomain: "sneakprognose-dc163.firebaseapp.com",
                projectId: "sneakprognose-dc163",
                storageBucket: "sneakprognose-dc163.appspot.com",
                messagingSenderId: "332816950518",
                appId: "1:332816950518:web:d35dbbc1a5ca7c8e6e38d7"
            };
            
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            
            window.sneakDb = { db, doc, setDoc, getDoc, onSnapshot };
            Alpine.data('sneakApp', () => ({
                online: navigator.onLine,
                data: { de: null, ov: null, prediction: null, archive: [] },
                userRating: 0,
                ratingSaved: false,
                countdown: '--:--:--',
                nextMondayText: '',
                adminModal: false,
                isAdmin: false,
                adminPassword: '',
                newPrediction: { title: '', prob: 50 },
                adminData: { de: { title: '', meta: '' }, ov: { title: '', meta: '' } },
                
                init() {
                    // Online/Offline
                    window.addEventListener('online', () => this.online = true);
                    window.addEventListener('offline', () => this.online = false);
                    
                    // Load data
                    this.loadData();
                    
                    // Countdown
                    this.updateCountdown();
                    setInterval(() => this.updateCountdown(), 1000);
                    
                    // User rating from localStorage
                    this.userRating = parseInt(localStorage.getItem('sneakRating') || '0');
                },
                
                async loadData() {
                    if (!window.sneakDb) return;
                    const { db, doc, getDoc } = window.sneakDb;
                    
                    try {
                        const snap = await getDoc(doc(db, 'sneaks', 'current'));
                        if (snap.exists()) {
                            this.data = snap.data();
                            // Load admin data
                            this.adminData.de = { ...this.data.de } || { title: '', meta: '' };
                            this.adminData.ov = { ...this.data.ov } || { title: '', meta: '' };
                        }
                    } catch(e) {
                        console.log('Offline oder Fehler:', e);
                    }
                },
                
                async saveAll() {
                    const { db, doc, setDoc } = window.sneakDb;
                    await setDoc(doc(db, 'sneaks', 'current'), {
                        ...this.data,
                        de: this.adminData.de,
                        ov: this.adminData.ov,
                        prediction: this.newPrediction.title ? this.newPrediction : this.data.prediction
                    });
                    this.adminModal = false;
                    this.loadData();
                },
                
                async savePrediction() {
                    if (!this.newPrediction.title) return;
                    const { db, doc, setDoc } = window.sneakDb;
                    await setDoc(doc(db, 'sneaks', 'current'), {
                        ...this.data,
                        prediction: this.newPrediction
                    });
Data();
                },
                
                async rate                    this.load(stars) {
                    this.userRating = stars;
                    localStorage.setItem('sneakRating', stars);
                    this.ratingSaved = true;
                    setTimeout(() => this.ratingSaved = false, 2000);
                },
                
                checkAdmin() {
                    // Passwort: in Firebase Console √§ndern!
                    if (this.adminPassword === 'sneak2026') {
                        this.isAdmin = true;
                    } else {
                        alert('Falsches Passwort!');
                    }
                },
                
                updateCountdown() {
                    const now = new Date();
                    const days = ['Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag'];
                    const currentDay = now.getDay();
                    const daysUntilMonday = currentDay === 0 ? 1 : (8 - currentDay) % 7 || 1;
                    
                    const nextMonday = new Date(now);
                    nextMonday.setDate(now.getDate() + daysUntilMonday);
                    nextMonday.setHours(19, 0, 0, 0);
                    
                    const diff = nextMonday - now;
                    const hours = Math.floor(diff / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                    
                    this.countdown = `${hours.toString().padStart(2,'0')}:${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
                    this.nextMondayText = days[nextMonday.getDay()] + ' ' + nextMonday.getDate() + '.' + (nextMonday.getMonth()+1) + '.';
                }
            }));
            
            Alpine.init();
        };
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</body>
</html>
