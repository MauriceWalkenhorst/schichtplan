<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Walter Mitty | Schichtplan Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #0f172a; color: #f1f5f9; }
        .glass { background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .card-glow:hover { border-color: rgba(59, 130, 246, 0.4); box-shadow: 0 0 30px rgba(59, 130, 246, 0.15); }
        .active-tab { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%) !important; color: white !important; box-shadow: 0 10px 20px -5px rgba(37, 99, 235, 0.4); }
        [x-cloak] { display: none !important; }
        .gradient-text { background: linear-gradient(135deg, #fff 0%, #94a3b8 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .status-pulse { animation: pulse-blue 2s infinite; }
        @keyframes pulse-blue { 0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); } 100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); } }
    </style>
</head>
<body class="min-h-screen pb-20 bg-[radial-gradient(ellipse_at_top_left,_var(--tw-gradient-stops))] from-slate-900 via-slate-900 to-black">

    <div x-data="shiftApp()" x-init="loadShifts()" x-cloak class="max-w-4xl mx-auto p-4 md:p-10">
        
        <!-- Header Section -->
        <header class="mb-12">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-8">
                <div class="flex items-center gap-5">
                    <a href="index.html" class="glass w-12 h-12 rounded-2xl flex items-center justify-center hover:bg-white/10 transition-all active:scale-95 group">
                        <i class="fas fa-chevron-left text-slate-400 group-hover:text-blue-400"></i>
                    </a>
                    <div>
                        <h1 class="text-4xl font-extrabold tracking-tight gradient-text">Schichtplan Pro</h1>
                        <p class="text-slate-500 font-medium flex items-center gap-2">
                            <span class="w-1.5 h-1.5 rounded-full bg-emerald-500"></span> 
                            UCI Ruhr Park · Quinyx Sync
                        </p>
                    </div>
                </div>
                
                <!-- Quick Stats Grid -->
                <div class="grid grid-cols-2 gap-3 w-full md:w-auto">
                    <div class="glass p-5 rounded-[2rem] border-t border-white/5 min-w-[140px]">
                        <div class="text-[10px] text-slate-500 font-black uppercase tracking-[0.2em] mb-1">Diese Woche</div>
                        <div class="flex items-baseline gap-1">
                            <span class="text-3xl font-black text-white" x-text="getCurrentWeekHours()"></span>
                            <span class="text-[10px] font-extrabold text-blue-500 uppercase">Std</span>
                        </div>
                    </div>
                    <div class="glass p-5 rounded-[2rem] border-t border-white/5 min-w-[140px]">
                        <div class="text-[10px] text-slate-500 font-black uppercase tracking-[0.2em] mb-1">Kommend</div>
                        <div class="flex items-baseline gap-1">
                            <span class="text-3xl font-black text-white" x-text="upcomingCount"></span>
                            <span class="text-[10px] font-extrabold text-purple-500 uppercase">Schichten</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Today's Focus Card (Only if shift today) -->
        <template x-if="todayShift">
            <section class="mb-12">
                <div class="relative group">
                    <div class="absolute -inset-1 bg-gradient-to-r from-blue-600 to-cyan-600 rounded-[2.5rem] blur opacity-25 group-hover:opacity-40 transition duration-1000"></div>
                    <div class="relative glass rounded-[2.5rem] p-8 overflow-hidden border border-white/10">
                        <div class="flex flex-col md:flex-row justify-between gap-8 relative z-10">
                            <div>
                                <div class="flex items-center gap-3 mb-6">
                                    <span class="bg-blue-500 text-white text-[10px] font-black px-3 py-1 rounded-full uppercase tracking-widest">Heute</span>
                                    <span class="text-slate-400 text-xs font-bold" x-text="formatDate(todayShift.start, 'full')"></span>
                                </div>
                                <h2 class="text-4xl font-black text-white mb-2" x-text="cleanTitle(todayShift.title)"></h2>
                                <p class="text-xl text-blue-400 font-bold mb-8">
                                    <span x-text="formatTime(todayShift.start)"></span> – <span x-text="formatTime(todayShift.end)"></span>
                                </p>
                                <div class="flex gap-4">
                                    <div class="bg-white/5 rounded-2xl px-5 py-3 border border-white/5">
                                        <div class="text-[9px] text-slate-500 font-bold uppercase mb-1">Dauer</div>
                                        <div class="text-sm font-bold text-white" x-text="getDuration(todayShift.start, todayShift.end)"></div>
                                    </div>
                                    <div class="bg-white/5 rounded-2xl px-5 py-3 border border-white/5">
                                        <div class="text-[9px] text-slate-500 font-bold uppercase mb-1">Verdienst</div>
                                        <div class="text-sm font-bold text-emerald-400" x-text="calculateShiftPay(todayShift) + ' €'"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Live Status Widget -->
                            <div class="flex flex-col items-center justify-center md:items-end md:justify-between text-center md:text-right min-w-[180px]">
                                <template x-if="isCurrentlyWorking(todayShift)">
                                    <div class="flex flex-col items-center md:items-end">
                                        <div class="w-20 h-20 rounded-full border-4 border-blue-500/20 flex items-center justify-center mb-4 status-pulse bg-blue-500/5">
                                            <i class="fas fa-briefcase text-2xl text-blue-500"></i>
                                        </div>
                                        <div class="text-xs font-black text-blue-400 uppercase tracking-widest mb-1">Aktuell im Dienst</div>
                                        <div class="text-[10px] text-slate-500 font-medium">Noch <span x-text="getTimeLeft(todayShift.end)"></span></div>
                                    </div>
                                </template>
                                <template x-if="!isCurrentlyWorking(todayShift) && new Date(todayShift.start) > new Date()">
                                    <div class="flex flex-col items-center md:items-end opacity-60">
                                        <div class="w-16 h-16 rounded-full border-2 border-white/10 flex items-center justify-center mb-4">
                                            <i class="fas fa-hourglass-start text-xl text-slate-500"></i>
                                        </div>
                                        <div class="text-xs font-black text-slate-500 uppercase tracking-widest mb-1">Beginnt bald</div>
                                        <div class="text-[10px] text-slate-500 font-medium">In <span x-text="getTimeUntil(todayShift.start)"></span></div>
                                    </div>
                                </template>
                            </div>
                        </div>
                        
                        <!-- Background Accent -->
                        <i class="fas fa-ticket-alt absolute -bottom-10 -right-10 text-[12rem] text-white/[0.02] -rotate-12"></i>
                    </div>
                </div>
            </section>
        </template>

        <!-- Navigation -->
        <nav class="flex flex-col md:flex-row justify-between items-center mb-8 gap-6">
            <div class="bg-white/5 p-1.5 rounded-2xl flex gap-1 w-full md:w-auto">
                <button @click="salaryView = false; filter = 'upcoming'" 
                    :class="!salaryView && filter === 'upcoming' ? 'active-tab' : 'text-slate-400 hover:text-white'" 
                    class="flex-1 md:flex-none px-8 py-3 rounded-xl text-xs font-black transition-all uppercase tracking-widest">Kommende</button>
                <button @click="salaryView = false; filter = 'all'" 
                    :class="!salaryView && filter === 'all' ? 'active-tab' : 'text-slate-400 hover:text-white'" 
                    class="flex-1 md:flex-none px-8 py-3 rounded-xl text-xs font-black transition-all uppercase tracking-widest">Verlauf</button>
                <button @click="salaryView = true" 
                    :class="salaryView ? 'active-tab' : 'text-slate-400 hover:text-white'" 
                    class="flex-1 md:flex-none px-8 py-3 rounded-xl text-xs font-black transition-all flex items-center justify-center gap-3 uppercase tracking-widest">
                    <i class="fas fa-receipt text-[10px]"></i> Gehalt
                </button>
            </div>

            <!-- Weekly Summary Tabs -->
            <div class="flex gap-2 overflow-x-auto no-scrollbar w-full md:w-auto pb-2" x-show="!salaryView">
                <template x-for="week in getWeeklyHours()" :key="week.label">
                    <div class="glass px-5 py-3 rounded-2xl flex-shrink-0">
                        <div class="text-[8px] text-slate-500 font-black uppercase tracking-widest mb-1" x-text="week.label"></div>
                        <div class="text-sm font-black text-white tracking-tight"><span x-text="week.hours"></span> <span class="text-[10px] text-slate-500 uppercase ml-0.5">h</span></div>
                    </div>
                </template>
            </div>
        </nav>

        <!-- Content Area -->
        <main>
            <!-- Loading State -->
            <div x-show="loading" class="flex flex-col items-center justify-center py-32">
                <div class="relative">
                    <div class="w-16 h-16 border-4 border-blue-500/10 border-t-blue-500 rounded-full animate-spin"></div>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i class="fas fa-paper-plane text-blue-500 animate-pulse text-xs"></i>
                    </div>
                </div>
                <p class="text-slate-600 font-bold mt-6 text-xs uppercase tracking-[0.3em] animate-pulse">Syncing Walter OS</p>
            </div>

            <!-- Salary Grid -->
            <div x-show="salaryView && !loading" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 translate-y-4" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <template x-for="month in getMonthlySalary()" :key="month.label">
                    <div class="glass rounded-[3rem] p-10 border border-emerald-500/10 relative overflow-hidden group">
                        <div class="absolute inset-0 bg-gradient-to-br from-emerald-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-700"></div>
                        
                        <h3 class="text-slate-500 text-[10px] font-black uppercase tracking-[0.2em] mb-4" x-text="month.label"></h3>
                        <div class="text-6xl font-black text-white mb-10 tracking-tighter flex items-start">
                            <span x-text="month.totalFormatted"></span><span class="text-2xl text-emerald-500 ml-2 mt-2">€</span>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-3 mb-10">
                            <div class="bg-white/5 p-4 rounded-3xl border border-white/5">
                                <div class="text-[9px] text-slate-500 font-bold uppercase mb-1">Grundlohn</div>
                                <div class="text-lg font-black text-white leading-none"><span x-text="month.baseFormatted"></span> <span class="text-[10px] text-slate-500">h</span></div>
                            </div>
                            <div class="bg-indigo-500/5 p-4 rounded-3xl border border-indigo-500/10">
                                <div class="text-[9px] text-indigo-400 font-bold uppercase mb-1">Nacht</div>
                                <div class="text-lg font-black text-indigo-400 leading-none"><span x-text="month.nightFormatted"></span> <span class="text-[10px] text-indigo-500/50">h</span></div>
                            </div>
                        </div>

                        <div x-data="{ extracted: null, status: '', async handle(e){ const f=e.target.files[0]; if(!f)return; this.status='Analysiere...'; const ab=await f.arrayBuffer(); const pdf=await pdfjsLib.getDocument(ab).promise; const page=await pdf.getPage(1); const tc=await page.getTextContent(); const text=tc.items.map(i=>i.str).join(' '); const bm=text.match(/Gesamtbrutto|Brutto.*?(\d+[.,]\d{2})/i); this.extracted=bm?bm[1]:'n.a.'; this.status=''; } }">
                            <label class="flex flex-col items-center justify-center w-full h-24 border-2 border-white/5 border-dashed rounded-[2rem] cursor-pointer bg-white/[0.02] hover:bg-white/5 hover:border-emerald-500/30 transition-all">
                                <div class="flex items-center gap-4 px-6">
                                    <i class="fas fa-fingerprint text-emerald-500 text-xl" x-show="!extracted && !status"></i>
                                    <span x-show="!extracted && !status" class="text-[10px] text-slate-500 font-black uppercase tracking-widest">Verify with Lohnabrechnung</span>
                                    <span x-show="status" x-text="status" class="text-xs text-emerald-500 font-bold animate-pulse"></span>
                                </div>
                                <div x-show="extracted" class="flex items-center gap-6 animate-fadeIn">
                                    <div class="text-center">
                                        <div class="text-[8px] text-slate-500 font-bold uppercase mb-1 tracking-tighter">PDF Brutto</div>
                                        <div class="text-xl font-black text-emerald-400" x-text="extracted + ' €'"></div>
                                    </div>
                                    <button @click.prevent="extracted=null" class="w-10 h-10 rounded-full bg-red-500/10 text-red-500 flex items-center justify-center transition-transform hover:scale-110 active:scale-90"><i class="fas fa-undo-alt text-xs"></i></button>
                                </div>
                                <input type="file" class="hidden" accept="application/pdf" @change="handle($event)" />
                            </label>
                        </div>
                    </div>
                </template>
            </div>

            <!-- List of Shifts -->
            <div class="space-y-4" x-show="!salaryView && !loading" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 translate-y-4">
                <template x-for="(shift, index) in filteredShifts" :key="index">
                    <div class="group glass rounded-[2.5rem] p-7 border border-white/5 card-glow transition-all duration-500 relative overflow-hidden active:scale-[0.98]">
                        <div class="flex items-center gap-6 md:gap-10 relative z-10">
                            <!-- Premium Date Badge -->
                            <div class="flex-shrink-0 w-20 h-20 rounded-[2rem] bg-gradient-to-br from-white/[0.05] to-transparent flex flex-col items-center justify-center border border-white/10 group-hover:from-blue-600 group-hover:to-blue-800 transition-all duration-500 shadow-xl">
                                <div class="text-[9px] text-slate-500 font-black uppercase tracking-widest group-hover:text-white/60 mb-0.5" x-text="formatDate(shift.start, 'month')"></div>
                                <div class="text-3xl font-black text-white leading-none tracking-tighter group-hover:scale-110 transition-transform duration-500" x-text="formatDate(shift.start, 'day')"></div>
                                <div class="text-[10px] text-blue-500 font-black uppercase tracking-tighter mt-1 group-hover:text-white/80" x-text="formatDate(shift.start, 'weekday')"></div>
                            </div>

                            <!-- Detailed Shift Info -->
                            <div class="flex-grow">
                                <div class="flex flex-col md:flex-row md:items-center justify-between gap-2 mb-3">
                                    <h3 class="text-xl font-extrabold text-white tracking-tight group-hover:text-blue-400 transition-colors" x-text="cleanTitle(shift.title)"></h3>
                                    <div class="flex items-center gap-2">
                                        <span :class="getRoleBadgeStyle(shift.title)" class="px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-[0.15em] border" x-text="getRoleName(shift.title)"></span>
                                    </div>
                                </div>
                                <div class="flex flex-wrap items-center gap-x-6 gap-y-2">
                                    <div class="flex items-center gap-2.5">
                                        <div class="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-slate-500">
                                            <i class="far fa-clock text-xs"></i>
                                        </div>
                                        <span class="text-lg font-bold text-slate-200 tracking-tight"><span x-text="formatTime(shift.start)"></span> – <span x-text="formatTime(shift.end)"></span></span>
                                    </div>
                                    <div class="flex items-center gap-2 text-slate-500">
                                        <i class="fas fa-stopwatch text-[10px] opacity-40"></i>
                                        <span class="text-xs font-bold uppercase tracking-widest" x-text="getDuration(shift.start, shift.end)"></span>
                                    </div>
                                    <div class="flex items-center gap-2 text-slate-500">
                                        <i class="fas fa-map-pin text-[10px] opacity-40"></i>
                                        <span class="text-[10px] font-bold uppercase tracking-widest">RP · Saal 8-14</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Arrow Indicator Desktop -->
                            <div class="hidden md:flex items-center justify-center w-12 h-12 rounded-full border border-white/5 group-hover:border-blue-500/30 transition-all opacity-0 group-hover:opacity-100 -translate-x-4 group-hover:translate-x-0">
                                <i class="fas fa-arrow-right text-blue-500 text-xs"></i>
                            </div>
                        </div>
                        
                        <!-- Mini Progress Line for completed shifts -->
                        <div x-show="new Date(shift.end) < new Date()" class="absolute bottom-0 left-0 h-1 bg-slate-800 w-full opacity-30"></div>
                        <div x-show="isCurrentlyWorking(shift)" class="absolute bottom-0 left-0 h-1 bg-blue-500 w-full shadow-[0_0_10px_#3b82f6]"></div>
                    </div>
                </template>

                <!-- No Data State -->
                <div x-show="filteredShifts.length === 0" class="flex flex-col items-center justify-center py-32 glass rounded-[3rem] border border-dashed border-white/5">
                    <div class="w-24 h-24 bg-slate-900 rounded-full flex items-center justify-center mb-6 border border-white/5">
                        <i class="fas fa-calendar-alt text-3xl text-slate-800"></i>
                    </div>
                    <h3 class="text-slate-400 font-black uppercase tracking-[0.2em] text-sm">Keine Daten verfügbar</h3>
                    <p class="text-slate-600 text-xs mt-2 font-medium">Walter konnte keine Schichten in diesem Slot finden.</p>
                </div>
            </div>
        </main>

        <!-- Floating Refresh Button -->
        <button @click="loadShifts()" class="fixed bottom-8 right-8 w-14 h-14 glass rounded-2xl flex items-center justify-center text-blue-400 border border-blue-500/20 shadow-2xl hover:scale-110 active:scale-95 transition-all z-50">
            <i class="fas fa-sync-alt" :class="loading ? 'animate-spin' : ''"></i>
        </button>
    </div>

    <script>
        function shiftApp() {
            return {
                rawShifts: [],
                filter: 'upcoming',
                salaryView: false,
                loading: true,
                async loadShifts() {
                    this.loading = true;
                    try {
                        const res = await fetch('shifts.json?' + Date.now());
                        this.rawShifts = await res.json();
                    } catch (e) {
                        console.error(e);
                    } finally {
                        setTimeout(() => { this.loading = false; }, 600);
                    }
                },
                get todayShift() {
                    const today = new Date().toISOString().split('T')[0];
                    return this.rawShifts.find(s => s.start.startsWith(today));
                },
                isCurrentlyWorking(shift) {
                    const now = new Date();
                    return now >= new Date(shift.start) && now <= new Date(shift.end);
                },
                getTimeLeft(end) {
                    const diff = new Date(end) - new Date();
                    const h = Math.floor(diff / 3600000);
                    const m = Math.floor((diff % 3600000) / 60000);
                    return `${h}h ${m}m`;
                },
                getTimeUntil(start) {
                    const diff = new Date(start) - new Date();
                    const h = Math.floor(diff / 3600000);
                    const m = Math.floor((diff % 3600000) / 60000);
                    return h > 0 ? `${h}h ${m}m` : `${m}m`;
                },
                calculateShiftPay(shift) {
                    const h = (new Date(shift.end) - new Date(shift.start)) / 3600000;
                    let b = 0; if (h > 9) b = 0.75; else if (h > 6) b = 0.5;
                    const net = Math.max(0, h - b);
                    return (net * 14.23).toFixed(2).replace('.', ',');
                },
                toISODate(d) { return d.getFullYear() + '-' + String(d.getMonth()+1).padStart(2,'0') + '-' + String(d.getDate()).padStart(2,'0'); },
                getCinemaWeek(d) {
                    const anchor = new Date('2026-01-01T00:00:00');
                    const current = new Date(d); current.setHours(0,0,0,0);
                    const day = current.getDay();
                    const diff = (day < 4 ? day + 7 : day) - 4;
                    current.setDate(current.getDate() - diff);
                    return Math.round((current - anchor) / 604800000) + 1;
                },
                get filteredShifts() { 
                    const now = new Date();
                    if (this.filter === 'upcoming') {
                        return this.rawShifts.filter(s => new Date(s.end) >= now).sort((a,b) => new Date(a.start) - new Date(b.start));
                    }
                    return [...this.rawShifts].sort((a,b) => new Date(b.start) - new Date(a.start)); 
                },
                get upcomingCount() { return this.rawShifts.filter(s => new Date(s.end) >= new Date()).length; },
                formatDate(ds, p) {
                    const d = new Date(ds); const o = { timeZone: 'Europe/Berlin' };
                    if (p === 'weekday') return d.toLocaleDateString('de-DE', { ...o, weekday: 'short' });
                    if (p === 'day') return d.toLocaleDateString('de-DE', { ...o, day: '2-digit' });
                    if (p === 'month') return d.toLocaleDateString('de-DE', { ...o, month: 'short' });
                    if (p === 'full') return d.toLocaleDateString('de-DE', { ...o, weekday: 'long', day: '2-digit', month: 'long' });
                    return '';
                },
                formatTime(ds) { return new Date(ds).toLocaleTimeString('de-DE', { timeZone: 'Europe/Berlin', hour: '2-digit', minute: '2-digit' }); },
                getCurrentWeekHours() {
                    const now = new Date();
                    const day = now.getDay();
                    const diff = (day < 4 ? day + 7 : day) - 4;
                    const ws = new Date(now); ws.setDate(now.getDate() - diff); ws.setHours(0,0,0,0);
                    const we = new Date(ws); we.setDate(ws.getDate() + 7);
                    let h = 0;
                    this.rawShifts.forEach(s => {
                        const ss = new Date(s.start);
                        if (ss >= ws && ss < we) h += this.getNetDuration(s.start, s.end);
                    });
                    return h.toFixed(1);
                },
                getDuration(s, e) {
                    const d = (new Date(e) - new Date(s)) / 3600000;
                    const h = Math.floor(d); const m = Math.round((d-h)*60);
                    return h + 'h' + (m > 0 ? ' ' + m + 'm' : '');
                },
                getNetDuration(s, e) {
                    const h = (new Date(e) - new Date(s)) / 3600000;
                    let b = 0; if (h > 9) b = 0.75; else if (h > 6) b = 0.5;
                    return Math.max(0, h - b);
                },
                getWeeklyHours() {
                    const w = {};
                    this.rawShifts.forEach(s => {
                        const d = new Date(s.start); const day = d.getDay(); const diff = (day < 4 ? day + 7 : day) - 4;
                        const ws = new Date(d); ws.setDate(d.getDate() - diff); ws.setHours(0,0,0,0);
                        const k = this.toISODate(ws);
                        if (!w[k]) w[k] = 0; w[k] += this.getNetDuration(s.start, s.end);
                    });
                    const res = [];
                    Object.keys(w).sort().reverse().forEach((k, i) => {
                        if (i > 3) return; // Only show last 4 weeks
                        const s = new Date(k); const e = new Date(s); e.setDate(s.getDate() + 6);
                        res.push({ label: 'KW ' + this.getCinemaWeek(s), hours: w[k].toFixed(1) });
                    });
                    return res;
                },
                getMonthlySalary() {
                    const m = {};
                    this.rawShifts.forEach(s => {
                        const d = new Date(s.start); const k = d.getFullYear() + '-' + String(d.getMonth()+1).padStart(2,'0');
                        if (!m[k]) m[k] = { label: d.toLocaleDateString('de-DE', { month: 'long', year: 'numeric' }), base: 0, night: 0, total: 0 };
                        const net = this.getNetDuration(s.start, s.end);
                        const n = this.getNightHours(s.start, s.end);
                        m[k].base += net; m[k].night += n;
                        m[k].total += (net * 14.23) + (n * 14.23 * 0.25);
                    });
                    return Object.values(m).sort((a,b) => b.label.localeCompare(a.label)).map(i => ({ ...i, totalFormatted: i.total.toFixed(2).replace('.', ','), baseFormatted: i.base.toFixed(1), nightFormatted: i.night.toFixed(1) }));
                },
                getNightHours(s, e) {
                    const st = new Date(s); const en = new Date(e);
                    const ns = new Date(st); ns.setHours(23,0,0,0);
                    const ne = new Date(st); ne.setDate(ne.getDate()+1); ne.setHours(6,0,0,0);
                    const os = new Date(Math.max(st, ns)); const oe = new Date(Math.min(en, ne));
                    return oe > os ? (oe - os) / 3600000 : 0;
                },
                cleanTitle(t) { return t.replace(/^ q: /, '').replace(/ \([^)]+\)/, '').replace('[*] ', ''); },
                getRoleBadgeStyle(t) {
                    if (t.includes('Kinokasse')) return 'bg-blue-500/10 text-blue-400 border-blue-500/20';
                    if (t.includes('Platzanweiser')) return 'bg-emerald-500/10 text-emerald-400 border-emerald-500/20';
                    if (t.includes('F&B')) return 'bg-orange-500/10 text-orange-400 border-orange-500/20';
                    return 'bg-white/5 text-slate-400 border-white/5';
                },
                getRoleName(t) {
                    if (t.includes('Kinokasse')) return 'Boxoffice';
                    if (t.includes('Platzanweiser')) return 'Floor';
                    if (t.includes('F&B')) return 'Gastro';
                    return 'Team';
                },
                getStatusDot(e) { return new Date(e) < new Date() ? 'bg-slate-700' : 'bg-blue-500 shadow-[0_0_10px_#3b82f6]'; }
            }
        }
    </script>
</body>
</html>
